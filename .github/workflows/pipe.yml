name: github-actions-pipeline
on: 
  pull_request:
    branches: [main]
jobs:
  Build:
    name: Build Test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      # Lint the code
      - name: Lint the code
        uses: github/super-linter@v4
        env:
          VALIDATE_ALL_CODEBASE: false
          DEFAULT_BRANCH: main
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  DeployStage:
    needs: [Build]
    name: Deploy Staging
    runs-on: ubuntu-latest
    environment:
      name: Staging
      url: ${{ env.DEPLOYED_URL }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      # Deploying to heroku
      - name: Deploying to heroku
        run: make deploy-heroku EMAIL=${{ secrets.EMAIL }} HEROKU_API_KEY=${{ secrets.HEROKU_API_KEY }} APP_NAME=${{ secrets.APP_NAME }}
      #  env:
      #    EMAIL: ${{ secrets.EMAIL }}
      #    HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
      #    APP_NAME: ${{ secrets.APP_NAME }}

      # Cleaning up the environment
      - name: Cleaning up the environtment
        if: ${{ always() }}
        run: make cleanup
